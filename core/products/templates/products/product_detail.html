{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} | HYPER TERMINAL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { 
            --primary: #00c9ff; 
            --secondary: #00ffe0; 
            --dark: #0b0c2a; 
            --deep-bg: #06071b;
            --glass: rgba(255, 255, 255, 0.05); 
            --success: #00ff88;
            --danger: #ff4d4d;
        }

        body { 
            margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; 
            background: radial-gradient(circle at center, #1a1b4b 0%, #0b0c2a 100%); 
            color: white; min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            height: 100%; width: 0; position: fixed; z-index: 2000;
            top: 0; left: 0; background: rgba(11, 12, 42, 0.98);
            backdrop-filter: blur(20px); overflow-x: hidden; transition: 0.5s;
            border-right: 1px solid var(--primary);
        }

        .profile-section {
            padding: 30px 20px;
            background: linear-gradient(180deg, rgba(0, 201, 255, 0.1) 0%, transparent 100%);
            text-align: center;
            border-bottom: 1px solid rgba(0, 201, 255, 0.2);
        }

        .user-avatar {
            width: 85px; height: 85px; border-radius: 50%;
            border: 2px solid var(--secondary); padding: 3px;
            object-fit: cover; background: var(--dark);
        }

        .sidebar a {
            padding: 15px 25px; text-decoration: none; font-size: 16px;
            color: #ccc; display: flex; align-items: center; transition: 0.3s;
            gap: 15px;
        }

        .sidebar a:hover { background: var(--glass); color: var(--secondary); padding-left: 35px; }

        /* --- NAVIGATION --- */
        .navbar { 
            background: rgba(11, 12, 42, 0.9); backdrop-filter: blur(15px);
            padding: 15px 30px; border-bottom: 1px solid rgba(0, 201, 255, 0.3); 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        .navbar-brand { font-size: 22px; font-weight: bold; color: white; text-decoration: none; letter-spacing: 2px; }
        .menu-toggle { font-size: 24px; cursor: pointer; color: var(--secondary); }
        .cart-icon { position: relative; color: white; text-decoration: none; font-size: 20px; }
        .cart-badge {
            position: absolute; top: -10px; right: -12px; background: var(--danger);
            font-size: 10px; padding: 2px 6px; border-radius: 50%; border: 1px solid white;
        }

        /* --- MAIN LAYOUT --- */
        .main-container { 
            display: grid; grid-template-columns: 1fr 1.2fr 0.8fr;
            max-width: 1400px; margin: 40px auto; gap: 30px; padding: 20px; 
        }

        .img-col { 
            background: var(--glass); border: 1px solid var(--primary); 
            border-radius: 24px; padding: 40px; text-align: center;
            position: relative; overflow: hidden; height: fit-content;
        }
        .img-col img { max-width: 100%; border-radius: 15px; filter: drop-shadow(0 0 15px var(--primary)); }

        .scanner-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--secondary); box-shadow: 0 0 15px var(--secondary);
            animation: scan 4s linear infinite; opacity: 0.4;
        }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        .specs-terminal {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 15px; margin: 20px 0;
        }

        .buy-box { 
            background: var(--glass); padding: 25px; border-radius: 20px; 
            border: 1px solid rgba(0, 201, 255, 0.2); backdrop-filter: blur(10px);
            height: fit-content; position: sticky; top: 100px;
        }
        
        .price-tag { font-size: 42px; color: var(--secondary); font-weight: bold; }
        .qty-input {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.3); color: white;
            border: 1px solid var(--primary); border-radius: 8px; margin: 10px 0 20px 0; box-sizing: border-box;
        }

        .btn-action { 
            width: 100%; padding: 16px; border: none; border-radius: 12px; 
            font-weight: bold; cursor: pointer; margin-bottom: 12px; transition: 0.3s;
        }
        .btn-cart { background: transparent; color: var(--primary); border: 2px solid var(--primary); }
        .btn-cart:hover { background: rgba(0, 201, 255, 0.1); }
        
        .btn-buy { background: linear-gradient(45deg, var(--primary), var(--secondary)); color: var(--dark); }
        .btn-buy:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--primary); }
        .btn-action:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* --- FOOTER STYLES --- */
        .hyper-amazon-footer { 
            background-color: var(--deep-bg); 
            color: white; 
            margin-top: 80px; 
            border-top: 2px solid var(--primary);
            box-shadow: 0 -10px 30px rgba(0, 201, 255, 0.15);
        }
        .footer-top-btn { 
            background: rgba(0, 201, 255, 0.08); 
            text-align: center; padding: 15px 0; 
            cursor: pointer; transition: 0.3s; 
            color: var(--secondary); font-weight: bold;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .footer-top-btn:hover { background: var(--primary); color: var(--dark); }
        .footer-main { 
            max-width: 1200px; margin: 0 auto; padding: 60px 20px; 
            display: flex; justify-content: space-around; flex-wrap: wrap; gap: 40px; 
        }
        .footer-col h4 { font-size: 16px; margin-bottom: 20px; color: var(--primary); text-transform: uppercase; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col ul li { margin-bottom: 12px; }
        .footer-col ul li a { color: #aaa; text-decoration: none; transition: 0.3s; font-size: 14px; }
        .footer-col ul li a:hover { color: var(--secondary); padding-left: 8px; }
        .footer-bottom { background-color: #03040f; padding: 40px 0; text-align: center; font-size: 12px; color: #555; }

        @media (max-width: 1000px) {
            .main-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div id="mySidebar" class="sidebar">
    <div class="profile-section">
        <span style="float:right; cursor:pointer; color: var(--primary);" onclick="closeNav()"><i class="fas fa-times"></i></span>
        <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=0b0c2a&color=00c9ff" class="user-avatar">
        <div style="font-weight: bold; margin-top: 10px; letter-spacing: 1px;">{{ user.username|upper }}</div>
    </div>
    <a href="{% url 'products' %}"><i class="fas fa-home"></i> Back to Feed</a>
    <a href="{% url 'cart_page' %}"><i class="fas fa-box"></i> My Inventory</a>
</div>

<div class="navbar">
    <div class="nav-left">
        <span class="menu-toggle" onclick="openNav()">&#9776;</span>
        <a href="{% url 'products' %}" class="navbar-brand">‚ö° HYPER</a>
    </div>
    <div class="nav-right">
        <a href="{% url 'cart_page' %}" class="cart-icon">
            <i class="fas fa-shopping-bag"></i>
            <span class="cart-badge">{{ cart_count }}</span>
        </a>
    </div>
</div>

<div class="main-container">
    <div class="img-col">
        <div class="scanner-line"></div>
        <img src="{{ product.image.url }}" alt="{{ product.name }}">
    </div>

    <div class="info-col">
        <span style="color: var(--secondary); font-size: 13px; letter-spacing: 3px;">UNIT ID: #PX-{{ product.id }}</span>
        <h1 style="font-size: 42px; margin: 10px 0;">{{ product.name }}</h1>
        
        <div class="specs-terminal">
            <div><span style="font-size: 11px; color: var(--primary);">CATEGORY</span><br><b>{{ product.get_category_display|upper }}</b></div>
            <div><span style="font-size: 11px; color: var(--primary);">STOCK STATUS</span><br>
                {% if product.stock > 0 %}
                <b style="color: var(--success);">AVAILABLE: {{ product.stock }} UNITS</b>
                {% else %}
                <b style="color: var(--danger);">DEPLETED</b>
                {% endif %}
            </div>
        </div>
        <p style="color: #aaa; line-height: 1.8;">{{ product.description }}</p>
        
        <h4 style="color: var(--primary); margin-top: 30px;"><i class="fas fa-microchip"></i> DATA SHEET</h4>
        <ul style="color: #888; font-size: 14px; list-style: square;">
            <li>Neural Core Compatibility: Level 5</li>
            <li>Power Requirement: 500W Pulse</li>
            <li>Encryption: 256-bit Quantum</li>
        </ul>
    </div>

    <div class="buy-box">
        <div class="price-tag">‚Çπ<span id="display-price">{{ product.price }}</span></div>
        <div style="font-size: 12px; color: #888; margin-bottom: 20px;">Subtotal for <span id="qty-count">1</span> unit(s)</div>
        
        <label style="font-size: 11px; color: var(--primary);">QUANTITY:</label>
        <input type="number" id="qty" class="qty-input" value="1" min="1" max="{{ product.stock }}" oninput="updatePrice()">

        <button id="cartBtn" class="btn-action btn-cart" onclick="handlePurchase('cart')" {% if product.stock == 0 %}disabled{% endif %}>
            <i class="fas fa-plus-circle"></i> ADD TO INVENTORY
        </button>
        <button id="buyBtn" class="btn-action btn-buy" onclick="handlePurchase('buy')" {% if product.stock == 0 %}disabled{% endif %}>
            <i class="fas fa-bolt"></i> INSTANT DEPLOY
        </button>
    </div>
</div>

<footer class="hyper-amazon-footer">
    <div class="footer-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'});">Jump to Top</div>
    <div class="footer-main">
        <div class="footer-col">
            <h4>Get to Know Us</h4>
            <ul>
                <li><a href="#">About Hyper</a></li>
                <li><a href="#">Careers</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Connect</h4>
            <ul>
                <li><a href="#">Data Stream</a></li>
                <li><a href="#">Insta-Grid</a></li>
            </ul>
        </div>
        <div class="footer-col">
            <h4>Assistance</h4>
            <ul>
                <li><a href="#">Your Account</a></li>
                <li><a href="#">Support Hub</a></li>
            </ul>
        </div>
    </div>
    <div class="footer-bottom">
        <p>¬© 2026, Hyper Terminal. All rights reserved.</p>
    </div>
</footer>

<script>
    const basePrice = parseFloat("{{ product.price }}");

    function openNav() { document.getElementById("mySidebar").style.width = "300px"; }
    function closeNav() { document.getElementById("mySidebar").style.width = "0"; }

    function updatePrice() {
        const qty = document.getElementById('qty').value;
        const total = (basePrice * qty).toFixed(2);
        document.getElementById('display-price').innerText = total;
        document.getElementById('qty-count').innerText = qty;
    }

    async function handlePurchase(mode) {
        const qty = document.getElementById('qty').value;
        const activeBtn = mode === 'buy' ? document.getElementById('buyBtn') : document.getElementById('cartBtn');
        const originalText = activeBtn.innerHTML;

        activeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> SYNCING...';
        activeBtn.disabled = true;

        const formData = new URLSearchParams();
        formData.append('name', "{{ product.name }}");
        formData.append('price', "{{ product.price }}");
        formData.append('quantity', qty);
        formData.append('action', mode);

        try {
            const response = await fetch("{% url 'add_to_cart' %}", {
                method: "POST",
                headers: { 
                    "X-CSRFToken": "{{ csrf_token }}", 
                    "Content-Type": "application/x-www-form-urlencoded" 
                },
                body: formData.toString()
            });

            const data = await response.json();

            if (data.status === 'success') {
                if (mode === 'buy' && data.redirect_url) {
                    window.location.href = data.redirect_url;
                } else {
                    alert("üöÄ MODULE ADDED TO INVENTORY");
                    location.reload(); 
                }
            } else {
                alert("‚ö†Ô∏è SYSTEM ERROR: " + data.message);
                activeBtn.innerHTML = originalText;
                activeBtn.disabled = false;
            }
        } catch (err) {
            alert("üö® TRANSMISSION FAILED: TERMINAL OFFLINE");
            activeBtn.innerHTML = originalText;
            activeBtn.disabled = false;
        }
    }
</script>
</body>
</html>