{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HYPER STORE | Future Shopping</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary: #00c9ff;
            --secondary: #00ffe0;
            --dark: #0b0c2a;
            --deep-bg: #06071b;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body { 
            margin: 0; font-family: 'Segoe UI', sans-serif; 
            background: radial-gradient(circle at center, #1a1b4b 0%, #0b0c2a 100%); 
            color: white; overflow-x: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            height: 100%; width: 0; position: fixed; z-index: 2000; top: 0; left: 0;
            background: rgba(11, 12, 42, 0.98); backdrop-filter: blur(15px);
            overflow-x: hidden; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 1px solid var(--primary);
        }

        .sidebar-header {
            padding: 30px 20px; background: linear-gradient(to right, var(--primary), var(--secondary));
            color: var(--dark); font-weight: bold; display: flex; justify-content: space-between; align-items: center;
        }

        .sidebar a {
            padding: 15px 25px; text-decoration: none; font-size: 18px; color: white;
            display: block; transition: 0.3s; border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .sidebar a:hover { background: var(--glass); color: var(--secondary); padding-left: 35px; }

        /* --- NAVBAR --- */
        .navbar {
            background: rgba(11, 12, 42, 0.9); backdrop-filter: blur(10px);
            padding: 10px 30px; display: flex; align-items: center; gap: 20px;
            position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(0, 201, 255, 0.3);
        }

        .navbar-brand { font-size: 22px; font-weight: bold; color: white; text-decoration: none; letter-spacing: 2px; }
        .menu-toggle { font-size: 24px; cursor: pointer; color: var(--secondary); transition: 0.3s; }

        /* --- SEARCH & SLIDER --- */
        .search-container {
            display: flex; flex-grow: 1; height: 40px; background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; overflow: hidden;
        }
        .search-container input { flex-grow: 1; padding: 10px; border: none; background: transparent; color: white; outline: none; }
        .search-container button { background: var(--primary); border: none; padding: 0 20px; cursor: pointer; color: var(--dark); font-weight: bold; }
        
        .slider-container { width: 100%; height: 400px; position: relative; overflow: hidden; border-bottom: 1px solid var(--primary); }
        .slider { display: flex; width: 300%; height: 100%; transition: transform 0.8s ease-in-out; }
        .slide { width: 33.33%; height: 100%; position: relative; background-size: cover; background-position: center; display: flex; align-items: center; }
        .slide-overlay { position: absolute; inset: 0; background: linear-gradient(to right, rgba(11, 12, 42, 0.9), transparent); }
        .slide-content { position: relative; z-index: 2; padding-left: 50px; }

        /* --- PRODUCT GRID --- */
        .container { padding: 40px; min-height: 400px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
        .card {
            background: var(--glass); padding: 20px; border-radius: 20px; text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1); transition: 0.4s;
        }
        .card:hover { transform: translateY(-10px); border-color: var(--secondary); box-shadow: 0 0 20px rgba(0, 255, 224, 0.2); }
        
        .product-link { text-decoration: none; color: inherit; display: block; }
        .product-link:hover h3 { color: var(--secondary); }

        .card img { width: 100%; height: 200px; object-fit: contain; margin-bottom: 15px; border-radius: 10px; }
        .btn { width: 100%; padding: 12px; background: linear-gradient(45deg, var(--primary), var(--secondary)); border: none; border-radius: 12px; cursor: pointer; font-weight: bold; color: var(--dark); transition: 0.3s; }
        .btn:active { transform: scale(0.95); opacity: 0.8; }

        /* --- FOOTER --- */
        .hyper-amazon-footer { background-color: var(--deep-bg); color: white; margin-top: 80px; border-top: 2px solid var(--primary); box-shadow: 0 -10px 30px rgba(0, 201, 255, 0.15); }
        .footer-top-btn { background: rgba(0, 201, 255, 0.08); text-align: center; padding: 15px 0; cursor: pointer; transition: 0.3s; color: var(--secondary); font-weight: bold; text-transform: uppercase; letter-spacing: 2px; }
        .footer-top-btn:hover { background: var(--primary); color: var(--dark); }
        .footer-main { max-width: 1200px; margin: 0 auto; padding: 60px 20px; display: flex; justify-content: space-around; flex-wrap: wrap; gap: 40px; }
        .footer-col h4 { font-size: 16px; margin-bottom: 20px; color: var(--primary); text-transform: uppercase; }
        .footer-col ul { list-style: none; padding: 0; }
        .footer-col ul li a { color: #aaa; text-decoration: none; transition: 0.3s; font-size: 14px; }
        .footer-col ul li a:hover { color: var(--secondary); padding-left: 8px; }
        .footer-mid { border-top: 1px solid rgba(255, 255, 255, 0.05); padding: 40px 0; background: rgba(0, 0, 0, 0.2); text-align: center; display: flex; justify-content: center; align-items: center; gap: 40px; }
        .footer-logo { font-size: 24px; font-weight: bold; color: var(--primary); text-shadow: 0 0 15px var(--primary); }
        .footer-bottom { background-color: #03040f; padding: 40px 0; text-align: center; font-size: 12px; color: #555; }
    </style>
</head>
<body>

{% csrf_token %}

<div id="mySidebar" class="sidebar">
    <div class="sidebar-header">
        <span>âš¡ HYPER MENU</span>
        <span style="cursor:pointer; font-size:24px;" onclick="closeNav()">&times;</span>
    </div>
    <a href="{% url 'products' %}"><i class="fas fa-home"></i> Main Feed</a>
    <a href="{% url 'cart_page' %}"><i class="fas fa-shopping-cart"></i> My Inventory</a>
    <a href="?category=electronics">Electronics</a>
    <a href="?category=fashion">Fashion</a>
</div>

<div class="navbar">
    <span class="menu-toggle" onclick="openNav()">&#9776;</span>
    <a href="{% url 'products' %}" class="navbar-brand">âš¡ HYPER</a>
    <form action="{% url 'products' %}" method="GET" class="search-container">
        <input type="text" name="search" placeholder="Scan inventory..." value="{{ request.GET.search|default:'' }}">
        <button type="submit">SEARCH</button>
    </form>
    <a href="{% url 'cart_page' %}" style="color:var(--secondary); text-decoration:none;">
        ðŸ›’ (<span id="cart-count">{{ cart_count }}</span>)
    </a>
</div>

<div class="slider-container">
    <div class="slider" id="main-slider">
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=2070');">
            <div class="slide-overlay"></div>
            <div class="slide-content"><h2>QUANTUM DECK PRO</h2><p>Sync your setup.</p></div>
        </div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1614850523296-d8c1af93d400?q=80&w=2070');">
            <div class="slide-overlay"></div>
            <div class="slide-content"><h2>NEURAL LINK v2</h2><p>Next-gen connectivity.</p></div>
        </div>
        <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=2070');">
            <div class="slide-overlay"></div>
            <div class="slide-content"><h2>CYBER HARDWARE</h2><p>Upgrade your core.</p></div>
        </div>
    </div>
</div>

<div class="container">
    <div class="grid">
        {% for product in products %}
        <div class="card">
            <a href="{% url 'product_detail' product.pk %}" class="product-link">
                <img src="{{ product.image.url }}" alt="{{ product.name }}">
                <h3>{{ product.name }}</h3>
            </a>
            <p style="color:var(--secondary); font-weight:bold;">â‚¹{{ product.price }}</p>
            <button class="btn" onclick="addToCart('{{ product.id }}', '{{ product.name }}')">ADD TO CART</button>
        </div>
        {% empty %}
        <p style="text-align: center; grid-column: 1/-1; color: #666;">No hardware found in this sector.</p>
        {% endfor %}
    </div>
</div>

<footer class="hyper-amazon-footer">
    <div class="footer-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'});">Jump to Top</div>
    <div class="footer-main">
        <div class="footer-col"><h4>Get to Know Us</h4><ul><li><a href="#">About Hyper</a></li><li><a href="#">Careers</a></li></ul></div>
        <div class="footer-col"><h4>Connect</h4><ul><li><a href="#">Data Stream</a></li><li><a href="#">X-Link</a></li></ul></div>
        <div class="footer-col"><h4>Assistance</h4><ul><li><a href="{% url 'profile_view' %}">Your Core Account</a></li><li><a href="#">Support Hub</a></li></ul></div>
    </div>
    <div class="footer-mid">
        <span class="footer-logo">âš¡ HYPER</span>
    </div>
    <div class="footer-bottom"><p>Â© 2026, Hyper Store Ltd. All rights reserved.</p></div>
</footer>

<script>
    function openNav() { document.getElementById("mySidebar").style.width = "300px"; }
    function closeNav() { document.getElementById("mySidebar").style.width = "0"; }

    // Slider Logic
    let slideIdx = 0;
    setInterval(() => {
        slideIdx = (slideIdx + 1) % 3;
        const slider = document.getElementById('main-slider');
        if(slider) slider.style.transform = `translateX(-${slideIdx * 33.33}%)`;
    }, 5000);

    // --- FUNCTIONAL ADD TO CART (AJAX) ---
    function addToCart(productId, productName) {
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        fetch("{% url 'add_to_cart' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': csrftoken
            },
            body: `product_id=${productId}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Update the navbar count dynamically
                document.getElementById('cart-count').innerText = data.cart_count;
                alert("ðŸš€ " + productName + " synced to inventory!");
            } else {
                alert("âš ï¸ Error: " + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("ðŸ›‘ System failure during sync.");
        });
    }
</script>

</body>
</html>